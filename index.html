<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link href="https://fonts.googleapis.com/css?family=Holtwood+One+SC&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="style.css">
    <title>JavaScript Hangman</title>
</head>

<body>

    <header>
        <h1>Wild Wild West<br>Criterion Hangman</h1>
    </header>

    <div class="container">

        <h3 id="directions-text"></h3>
        <br>
        <h2 id="displaySplitChar-text"></h2>
        <br>
        <p id="remainingGuesses-text"></p>
        <img height="350px">
        <p id="chosenGuesses-text"></p>

    </div>

    <footer>
        <h2 id="getWins-text"></h2>
        <h2 id="getLosses-text"></h2>
    </footer>

    <script>

        // List of puzzles
        let movies = [


            "mulholland drive",
            "persona",
            "seven samurai",
            "taxi driver",
            "the godfather",
            "apocalypse now",
            "there will be blood",
            "pulp fiction",
            "stalker",
            "the tree of life",
            "dr. strangelove",
            "citizen kane",
            "vertigo",
            "in the mood for love",
            "the empire strikes back",
            "synecdoche new york",
            "eternal sunshine of the spotless mind",
            "the night of the hunter",
            "fanny and alexander",
            "rear window",
            "spirited away",
            "the good, the bad, and the ugly",
            "paris, texas",
            "the shining",
            "mirror",
            "chinatown",
            "goodfellas",
            "the silence of the lambs",
            "yi yi",
            "blue velvet",
            "andrei roublev",
            "a clockwork orange",
            "city lights",
            "lawrence of arabia",
            "brighter summer day",
            "the seventh seal",
            "chungking express",
            "it's a wonderful life",
            "the double life of veronique",
            "the third man",
            "punch-drunk love",
            "blade runner",
            "eraserhead",
            "it's such a beautiful day",
            "annie hall",
            "psycho",
            "alien",
            "one flew over the cuckoo's nest",
            "the big lebowski",
            "her",
            "the umbrellas of cherbourg",
            "playtime",
            "star wars",
            "back to the future",
            "once upon a time in the west",
            "nashville",
            "lost in translation",
            "boogie nights",
            "tokyo story",
            "magnolia",
            "au hasard balthazar",
            "children of men",
            "before sunset",
            "badlands",
            "rashomon",
            "brazil",
            "before sunrise",
            "breathless",
            "heaven's gate",
            "all that jazz",
            "modern times",
            "dazed and confused",
            "last year at marienbad",
            "casablanca",
            "pan's labyrinth",
            "days of heaven",
            "the royal tenenbaums",
            "three colors red",
            "the graduate",
            "eyes wide shut",
            "the passion of joan of arc",
            "rosemary's baby",
            "come and see",
            "the apartment",
            "rushmore",
            "the master",
            "the battle of algiers",
            "sunrise",
            "american beauty",
            "fargo",
            "close up",
            "the thin red line",
            "the red shoes"
        ]

        // Display variables for HTML
        let directionsText = document.getElementById("directions-text");
        let remainingGuesses = document.getElementById("remainingGuesses-text");
        let displayHiddenMovie = document.getElementById("displayHiddenMovie-text");
        let displaySplitChar = document.getElementById("displaySplitChar-text");
        let chosenGuesses = document.getElementById("chosenGuesses-text");
        let currentImage = document.querySelectorAll("img");
        let background = document.querySelector("div");
        let displayWins = document.getElementById("getWins-text");
        let displayLosses = document.getElementById("getLosses-text");

        // Variables used in game
        let randomMovie = movies[Math.floor(Math.random() * movies.length)];
        let splitChar = randomMovie.split("");
        let wrongGuess = 6;
        let chosen = [];
        let wins = 0;
        let losses = 0;
        let whatImage = 1;

        // Initializes first puzzle (Can't get || to work on the if statement, resulting in a lot of else if's)
        function hideMovie(randomMovie) {

            for (i = 0; i < splitChar.length; i++) {

                if (splitChar[i] == " ") {

                } else if (splitChar[i] == ",") {

                } else if (splitChar[i] == "-") {

                } else if (splitChar[i] == "'") {

                } else if (splitChar[i] == ".") {

                } else {
                    splitChar[i] = "_";
                }
            }
        }

        // Allows for the display of spaces between words in the browser
        function encodeWhiteSpaces(str) {
            return str.split('').map(function (c) {
                if (c === ' ') {
                    return '&nbsp;&nbsp;'
                } else {
                    return c;
                }
            }).join('');
        }

        alert("Welcome to the wild wild west, where justice is decided by a bizarre game of hangman from the future. I know, it doesn't make any sense. Press OK to try and slip the noose.")

        // Starts first game and displays puzzle in browser
        hideMovie(randomMovie);
        directionsText.textContent = "Press any letter to make a guess.";
        currentImage[0].setAttribute("src", "./assets/hangman1.png");
        displaySplitChar.innerHTML = "Current puzzle: " + encodeWhiteSpaces(splitChar.join(" "));
        remainingGuesses.textContent = "You have " + wrongGuess + " remaining guesses.";
        chosenGuesses.textContent = "So far, you have chosen the following letters: " + chosen.join(", ");
        displayWins.textContent = "Wins: " + wins;
        displayLosses.textContent = "Losses: " + losses;


        document.onkeyup = function (event) {

            let userGuess = event.key;
            let guessStatus = 0;
            const letters = /^[A-Za-z]+$/;

            function resetGame() {

                randomMovie = movies[Math.floor(Math.random() * movies.length)];
                splitChar = randomMovie.split("");
                hideMovie(randomMovie);
                displaySplitChar.innerHTML = "Current puzzle: " + encodeWhiteSpaces(splitChar.join(" "));
                console.log("New random movie is: " + randomMovie);
                console.log("The new splitchar looks liek: " + splitChar);
                wrongGuess = 6;
                remainingGuesses.textContent = "You have " + wrongGuess + " remaining guesses.";
                chosen.length = 0;
                chosenGuesses.textContent = "So far, you have chosen the following letters: " + chosen.join(", ");
                whatImage = 1;
                currentImage[0].setAttribute("src", "./assets/hangman1.png");

            }

            // Verifies if an alpha character was selected, and then checks for duplicate guesses
            if (userGuess.match(letters)) {

                if (chosen.includes(userGuess.toUpperCase())) {
                    alert("You already selected this letter, please select a different letter.");
                } else {

                    chosen.push(userGuess.toUpperCase());

                    // This loop checks to see if the entered letter matches those in the puzzle
                    for (i = 0; i < splitChar.length; i++) {

                        if (userGuess.toLowerCase() === randomMovie[i]) {
                            splitChar[i] = randomMovie[i].toUpperCase();
                            displaySplitChar.innerHTML = "Current puzzle: " + encodeWhiteSpaces(splitChar.join(" "));
                            guessStatus++;
                        }
                    }

                    // This checks to see if there was a matching guess, if not, remaining guesses goes down
                    if (guessStatus === 0) {
                        wrongGuess--;
                        whatImage++;
                        currentImage[0].setAttribute("src", "./assets/hangman" + whatImage + ".png");
                    }
                }

            } else {
                alert("Please select a letter, ya half-wit.");
            }

            // This loop checks to see if the puzzle has been completed
            for (i = 0; i < splitChar.length; i++) {

                let stillPlay = splitChar.includes("_");

                // If underscores still exist, just keep guessing
                if (stillPlay) {

                } else {
                    // If no underscores remain, this action runs and ends the loop
                    alert("You've won! The solution was: " + randomMovie.toUpperCase() + " Press OK to play again");
                    displaySplitChar.textContent = (randomMovie.toUpperCase());
                    wins++;
                    displayWins.textContent = "Wins: " + wins;
                    i = splitChar.length;
                    resetGame();
                }
            }

            function loser() {
                let timer = setTimeout(loserAlert, 2000);
            }

            function loserAlert() {
                alert("Sorry cowboy, the jig is up. The correct solution was: " + randomMovie.toUpperCase() + "  Press OK to play again.");
                resetGame();
            }

            // This checks to see if the user has run out of guesses
            if (wrongGuess === 0) {

                displaySplitChar.textContent = randomMovie.toUpperCase();
                currentImage[0].setAttribute("src", "./assets/hangman7.png");
                losses++;
                displayLosses.textContent = "Losses: " + losses;
                loser();

            }

            console.log(randomMovie.toUpperCase());
            console.log(chosen);
            console.log(splitChar.join(" "));
            console.log(guessStatus);
            console.log(wrongGuess);
            remainingGuesses.textContent = "You have " + wrongGuess + " remaining guesses.";
            chosenGuesses.textContent = "So far, you have chosen the following letters: " + chosen.join(", ");

            // Hide the directions
            directionsText.textContent = "";

        }

    </script>

</body>

</html>