<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" type="text/stylesheet" href="./assets/style.css">
    <title>JavaScript Hangman</title>
</head>

<body>

    <div class="container">
        <h1>Welcome to Criterion Hangman!</h1>
        <p id="directions-text"></p>

        <p id="displaySplitChar-text"></p>
        <!-- <p id="demo"></p> -->
        <p id="displayHiddenMovie-text"></p>
        <p id="hiddenMovie-text"></p>
        <p id="displayRetainChar-text"></p>
        <p id="remainingGuesses-text"></p>
        <p id="chosenGuesses-text"></p>
        <br>
        <br>
        <p id="getWins-text"></p>
        <p id="getLosses-text"></p>

    </div>

    <script>

        // List of puzzles
        let movies = [
            "mulholland drive",
            "persona",
            "seven samurai",
            "taxi driver",
            "the godfather",
            "apocalypse now",
            "there will be blood",
            "pulp fiction",
            "stalker",
            "the tree of life",
            "dr. strangelove",
            "citizen kane",
            "vertigo",
            "in the mood for love",
            "the empire strikes back",
            "synecdoche new york",
            "eternal sunshine of the spotless mind",
            "the night of the hunter",
            "fanny and alexander",
            "rear window",
            "spirited away",
            "the good, the bad, and the ugly",
            "paris, texas",
            "the shining",
            "mirror",
            "chinatown",
            "goodfellas",
            "the silence of the lambs",
            "yi yi",
            "blue velvet",
            "andrei roublev",
            "a clockwork orange",
            "city lights",
            "lawrence of arabia",
            "brighter summer day",
            "the seventh seal",
            "chungking express",
            "it's a wonderful life",
            "the double life of veronique",
            "the third man",
            "punch-drunk love",
            "blade runner",
            "eraserhead",
            "it's such a beautiful day",
            "annie hall",
            "psycho",
            "alien",
            "one flew over the cuckoo's nest",
            "the big lebowski",
            "her",
            "the umbrellas of cherbourg",
            "playtime",
            "star wars",
            "back to the future",
            "once upon a time in the west",
            "nashville",
            "lost in translation",
            "boogie nights",
            "tokyo story",
            "magnolia",
            "au hasard balthazar",
            "children of men",
            "before sunset",
            "badlands",
            "rashomon",
            "brazil",
            "before sunrise",
            "breathless",
            "heaven's gate",
            "all that jazz",
            "modern times",
            "dazed and confused",
            "last year at marienbad",
            "casablanca",
            "pan's labyrinth",
            "days of heaven",
            "the royal tenenbaums",
            "three colors red",
            "the graduate",
            "eyes wide shut",
            "the passion of joan of arc",
            "rosemary's baby",
            "come and see",
            "the apartment",
            "rushmore",
            "the master",
            "the battle of algiers",
            "sunrise",
            "american beauty",
            "fargo",
            "close up",
            "the thin red line",
            "the red shoes"
        ]

        // Display variables for HTML
        let directionsText = document.getElementById("directions-text");
        let hiddenMovie = document.getElementById("hiddenMovie-text");
        let remainingGuesses = document.getElementById("remainingGuesses-text");
        let displayHiddenMovie = document.getElementById("displayHiddenMovie-text");
        let displaySplitChar = document.getElementById("displaySplitChar-text");
        let displayRetainChar = document.getElementById("displayRetainChar-text");
        let chosenGuesses = document.getElementById("chosenGuesses-text");
        let displayWins = document.getElementById("getWins-text");
        let displayLosses = document.getElementById("getLosses-text");

        // Variables used in game
        let randomMovie = movies[Math.floor(Math.random() * movies.length)];
        let splitChar = randomMovie.split("");
        let retainChar = randomMovie.split("");
        let wrongGuess = 6;
        let chosen = [];

        // console.log(randomMovie.length);
        console.log(randomMovie.toUpperCase());

        //displaySplitChar.textContent = splitChar.join(" ");

        //displayHiddenMovie.textContent = "Your puzzle is: " + splitChar;

        directionsText.textContent = "Welcome to Criterion Hangman!"
        //displayRetainChar.textContent = "Your split retained chars are " + retainChar;


        // Initializes first puzzle (Can't get || to work on the if statement, resulting in a lot of else if's)
        function hideMovie(randomMovie) {

            for (i = 0; i < splitChar.length; i++) {

                if (splitChar[i] == " ") {

                } else if (splitChar[i] == ",") {

                } else if (splitChar[i] == "-") {

                } else if (splitChar[i] == "'") {

                } else if (splitChar[i] == ".") {

                } else {
                    splitChar[i] = "_";
                }
            }
        }

        function encodeWhiteSpaces(str) {
            return str.split('').map(function (c) {
                if (c === ' ') {
                    return '&nbsp;&nbsp;'
                } else {
                    return c;
                }
            }).join('');
        }

        hideMovie(randomMovie);
        displaySplitChar.innerHTML = "Current puzzle: " + encodeWhiteSpaces(splitChar.join(" "));


        console.log(splitChar.join(" "));


        let gameOver = false;
        let wins = 0;
        let losses = 0;


        document.onkeyup = function (event) {


            let userGuess = event.key;
            let guessStatus = 0;
            const letters = /^[A-Za-z]+$/;



            // Verifies if an alpha character was selected.
            if (userGuess.match(letters)) {

                if (userGuess == chosen[i]) {

                }

            } else {

                alert("Please select a letter.");
                wrongGuess++;
            }


            // This checks to see if a guess is being duplicated.
            if (chosen.includes(userGuess)) {

                alert("You already selected this letter, please select a different letter.");

            } else {

                chosen.push(userGuess);
            }


            console.log(chosen);


            // This loop checks to see if the entered letter matches those in the puzzle
            for (i = 0; i < splitChar.length; i++) {

                if (userGuess.toLowerCase() === randomMovie[i]) {
                    console.log("We've got a match!");
                    splitChar[i] = randomMovie[i].toUpperCase();
                    displaySplitChar.innerHTML = "Current puzzle: " + encodeWhiteSpaces(splitChar.join(" "));
                    guessStatus++;
                }
            }

            // This loop checks to see if the puzzle has been completed
            for (i = 0; i < splitChar.length; i++) {

                let stillPlay = splitChar.includes("_");

                // If underscores still exist, just keep guessing
                if (stillPlay) {

                } else {
                    // If no underscores remain, this action runs and ends the loop
                    alert("You've won! The solution was: " + randomMovie.toUpperCase() + " Press OK to play again");
                    displaySplitChar.textContent = (randomMovie.toUpperCase());
                    chosen.length = 0;
                    gameOver = true;
                    wins++;
                    displayWins.textContent = "Wins: " + wins;
                    wrongGuess = 6;
                    i = splitChar.length;
                }
            }

            // This checks to see if there was a matching guess, if not, remaining guesses goes down
            if (guessStatus === 0) {
                wrongGuess--;
            }

            // This checks to see if the user has run out of guesses
            if (wrongGuess === 0) {

                displaySplitChar.textContent = (randomMovie.toUpperCase());
                alert("Sorry, you lose. The correct solution was: " + randomMovie.toUpperCase() + "  Press OK to play again.");
                gameOver = true;
                losses++;
                displayLosses.textContent = "Losses: " + losses;
                wrongGuess = 6;
                chosen.length = 0;
            }

            // This resets the game when gameOver become true
            if (gameOver) {

                randomMovie = movies[Math.floor(Math.random() * movies.length)];
                splitChar = randomMovie.split("");
                hideMovie(randomMovie);
                displaySplitChar.innerHTML = "Current puzzle: " + encodeWhiteSpaces(splitChar.join(" "));
                console.log("New random movie is: " + randomMovie);
                console.log("The new splitchar looks liek: " + splitChar);
                gameOver = false;
            }

            console.log(splitChar.join(" "));
            console.log(guessStatus);
            console.log(wrongGuess);
            remainingGuesses.textContent = "You have " + wrongGuess + " remaining guesses.";
            chosenGuesses.textContent = "So far, you have chosen the following letters: " + chosen;

        }


        // Remaining guesses



        // Hide the directions
        directionsText.textContent = "";

    </script>

</body>

</html>